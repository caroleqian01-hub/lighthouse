<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lighthouse Keeper</title>
    <meta name="theme-color" content="#050505">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">
    <style>
        /* === æ ·å¼è¡¨ä¿æŒä¸å˜ï¼Œä¸ºäº†èŠ‚çœç©ºé—´çœç•¥ï¼Œä¸ä¹‹å‰ä¸€è‡´ === */
        :root { --bg-base: #050505; --beam-color: rgba(255, 248, 220, 0.05); --beam-center: rgba(255, 255, 255, 0.4); --text-color: #e0e0e0; --accent-gold: #f1c40f; --input-bg: rgba(255, 255, 255, 0.1); }
        body { margin: 0; height: 100vh; background-color: var(--bg-base); font-family: "PingFang SC", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; color: var(--text-color); display: flex; flex-direction: column; align-items: center; overflow: hidden; transition: background-color 2s ease; }
        .savings-box { position: absolute; top: 20px; right: 20px; font-family: 'Monaco', monospace; font-size: 14px; color: var(--accent-gold); display: flex; align-items: center; gap: 5px; opacity: 0.8; z-index: 10; }
        .scene { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; display: flex; justify-content: center; align-items: center; }
        .tower { position: absolute; bottom: 0; width: 60px; height: 200px; background: linear-gradient(to top, #000, #1a1a1a); clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%); z-index: 2; }
        .lantern { position: absolute; bottom: 200px; width: 20px; height: 20px; background: #fff; border-radius: 50%; box-shadow: 0 0 20px #fff; z-index: 3; opacity: 0.5; transition: opacity 1s, box-shadow 1s; }
        .beam { position: absolute; bottom: 210px; width: 600px; height: 600px; background: radial-gradient(circle, var(--beam-center) 0%, var(--beam-color) 40%, transparent 70%); border-radius: 50%; opacity: 0; transform: scale(0.5); transition: opacity 1.5s ease, transform 1.5s ease, background 1.5s ease; animation: breathe 6s infinite ease-in-out; z-index: 1; }
        @keyframes breathe { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 0.6; } }
        .chat-container { position: relative; z-index: 5; flex: 1; width: 100%; max-width: 500px; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
        .message { font-size: 18px; line-height: 1.6; text-align: center; margin-bottom: 30px; min-height: 60px; text-shadow: 0 0 10px rgba(0,0,0,0.8); }
        .cursor::after { content: '|'; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% {opacity: 1;} 50% {opacity: 0;} }
        .input-area { position: relative; z-index: 10; width: 90%; max-width: 400px; margin-bottom: 40px; transition: opacity 0.5s; }
        input { width: 100%; background: var(--input-bg); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 15px; border-radius: 30px; font-size: 16px; text-align: center; outline: none; backdrop-filter: blur(5px); transition: all 0.3s; box-sizing: border-box; }
        input:focus { background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.5); }
        .choice-btns { display: none; gap: 20px; width: 100%; justify-content: center; z-index: 20; }
        .btn { padding: 12px 25px; border-radius: 25px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; transition: transform 0.2s; }
        .btn:active { transform: scale(0.95); }
        .btn-buy { background: rgba(255,255,255,0.1); color: #aaa; border: 1px solid #555; }
        .btn-save { background: var(--accent-gold); color: #000; box-shadow: 0 0 15px rgba(241, 196, 15, 0.4); }
        #particles { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 4; }
        .particle { position: absolute; background: white; border-radius: 50%; opacity: 0; }
    </style>
</head>
<body>

    <div class="savings-box"><span>âš“</span><span id="savingsDisplay">0</span></div>
    <div class="scene">
        <div class="beam" id="lightBeam"></div>
        <div class="lantern" id="lantern"></div>
        <div class="tower"></div>
        <div id="particles"></div>
    </div>
    <div class="chat-container"><div class="message" id="messageBox"></div></div>
    <div class="input-area" id="inputContainer"><input type="text" id="userInput" placeholder="å‘Šè¯‰æˆ‘ï¼Œä½ æƒ³ä¹°ä»€ä¹ˆ..." autocomplete="off"></div>
    <div class="choice-btns" id="choiceBtns">
        <button class="btn btn-buy" onclick="handleBuy()">ğŸ’¸ è¿˜æ˜¯ä¹°äº†</button>
        <button class="btn btn-save" onclick="handleSave()">âš“ å­˜ä¸‹è¿™ç¬”é’±</button>
    </div>

<script>
    // === æ ¸å¿ƒæ•°æ® ===
    let stage = 0; 
    let currentPrice = 0; 
    let totalSavings = parseFloat(localStorage.getItem('lighthouse_savings') || 0);

    // === ğŸŒŠ çµé­‚è¯­æ–™åº“ (åŒ…å«æ¨¡ä»¿è€…ã€ASDå‹å¥½é¢˜åº“) ===
    const scripts = {
        greetings: [
            "è¿™é‡Œæ˜¯å®ˆå¡”äººã€‚ä»Šæ™šçš„æµ·é¢æœ‰ç‚¹æµªï¼Œä½ æƒ³ä¹°ä»€ä¹ˆï¼Ÿå‘Šè¯‰æˆ‘åå­—å’Œä»·æ ¼ã€‚",
            "å˜˜... è¿™é‡Œå¾ˆå®‰é™ã€‚å°ç‹—å£«å…µï¼Œå‘Šè¯‰æˆ‘ï¼Œæ˜¯ä»€ä¹ˆä¸œè¥¿è®©ä½ åŠ¨å¿ƒäº†ï¼Ÿ",
            "æ¬¢è¿é å²¸ï¼Œå†’é™©å®¶ã€‚æŠŠé‚£ä¸ªè®©ä½ å¿ƒç—’ç—’çš„ä¸œè¥¿å‘Šè¯‰æˆ‘å§ã€‚",
            "å˜¿ï¼ŒLynnã€‚åˆæ˜¯ä¸€ä¸ªå……æ»¡è¯±æƒ‘çš„å¤œæ™šå—ï¼Ÿæˆ‘åœ¨å¬ã€‚",
            "è¿™é‡Œæ˜¯é¿é£æ¸¯ã€‚æ”¾ä¸‹ä½ çš„é”šï¼Œå‘Šè¯‰æˆ‘ä½ æƒ³ç”¨é‡‘å¸äº¤æ¢ä»€ä¹ˆï¼Ÿ",
            "æˆ‘çœ‹å¾—åˆ°ä½ ï¼Œå°ç‹—å£«å…µã€‚åˆ«æ€¥ï¼Œæ…¢æ…¢è¯´ï¼Œä½ æƒ³å¸¦èµ°ä»€ä¹ˆï¼Ÿ",
            "ç¯å¡”å·²ç‚¹äº®ã€‚æ— è®ºæ˜¯é£æš´è¿˜æ˜¯å®è—ï¼Œæˆ‘éƒ½å‡†å¤‡å¥½å€¾å¬äº†ã€‚",
            "æ—©å®‰ï¼ˆæˆ–è€…æ˜¯æ™šå®‰ï¼Ÿï¼‰ã€‚è¿™é‡Œæ°¸è¿œä¸ºä½ äº®ç€ç¯ã€‚è¾“å…¥é‚£ä¸ªæ•°å­—å§ã€‚"
        ],
        distraction: [
            "æ”¶åˆ°å•¦ã€‚åœ¨é‚£ä¹‹å‰ï¼Œèƒ½ä¸èƒ½å‘Šè¯‰æˆ‘ï¼Œä»Šå¤©ä½ é‚£è¾¹çš„äº‘æ˜¯ä»€ä¹ˆå½¢çŠ¶çš„ï¼Ÿâ˜ï¸",
            "æ‰«æä¸€ä¸‹ä½ çš„è§†é‡ï¼Œæ¨¡ä»¿è€…ã€‚æ‰¾å‡ºä¸‰ä¸ªã€åœ†å½¢çš„ã€‘ä¸œè¥¿ï¼Œå‘Šè¯‰æˆ‘å®ƒä»¬æ˜¯ä»€ä¹ˆï¼Ÿ",
            "æˆ‘ä¹Ÿæƒ³çœ‹çœ‹ã€‚ä½ å‘¨å›´æœ‰å¤šå°‘ä¸ªç›´è§’ï¼Ÿæ•°ä¸€æ•°ä½ é¢å‰çš„å±å¹•æˆ–æ¡Œå­æœ‰å‡ ä¸ªè§’ã€‚",
            "çœ‹çœ‹åœ°æ¿æˆ–å¢™å£çš„çº¹ç†ã€‚å®ƒæ˜¯é‡å¤çš„å›¾æ¡ˆå—ï¼Ÿç›¯ç€å…¶ä¸­ä¸€ä¸ªèŠ±çº¹çœ‹ 5 ç§’é’Ÿã€‚",
            "å¦‚æœæŠŠä½ ç°åœ¨çš„ç¯å¢ƒå®šä¹‰ä¸ºä¸€ç§é¢œè‰²ï¼Œé™¤äº†é»‘ç™½ï¼Œå®ƒæ˜¯ä»€ä¹ˆé¢œè‰²çš„ï¼Ÿ",
            "ç”¨æŒ‡å°–æ‘¸æ‘¸ä½ ç°åœ¨çš„è¡£æœé¢æ–™ã€‚æ˜¯ç²—ç³™çš„ï¼Œè¿˜æ˜¯é¡ºæ»‘çš„ï¼Ÿ",
            "æŠŠæ‰‹æŒè´´åœ¨æ¡Œé¢ä¸Šï¼ˆæˆ–è€…å¢™ä¸Šï¼‰ã€‚å®ƒæ˜¯å‡‰çš„å—ï¼ŸæŠŠä½ çš„ä½“æ¸©ä¼ ç»™å®ƒä¸€ç‚¹ç‚¹ã€‚",
            "æ„Ÿè§‰ä¸€ä¸‹ä½ çš„ç‰™é½¿ã€‚ä½ æ˜¯å’¬ç´§çš„ï¼Œè¿˜æ˜¯æ”¾æ¾çš„ï¼Ÿè¯•ç€æŠŠèˆŒå¤´æŠµåœ¨ä¸Šé¢šã€‚",
            "æ‰¾ä¸€ä¸ªç¦»ä½ æœ€è¿‘çš„ç‰©ä½“ï¼Œåªç”¨çœ¼ç›æç»˜å®ƒçš„è½®å»“çº¿ã€‚å®ƒçš„è¾¹ç¼˜æ˜¯é”‹åˆ©çš„å—ï¼Ÿ",
            "å˜˜... é—­ä¸Šçœ¼å¬ä¸€ç§’ï¼Œçª—å¤–ç°åœ¨æ˜¯é£å£°ã€è½¦å£°ï¼Œè¿˜æ˜¯è¡Œäººçš„è„šæ­¥å£°ï¼ŸğŸƒ"
        ],
        movement: [
            "å˜¿ï¼Œè¦ä¸æˆ‘ä»¬ç©ä¸ªæ¸¸æˆï¼Ÿå»æ‰¾ä¸€ä¸ªèƒ½çœ‹åˆ°å¤©ç©ºæˆ–è€…çª—æˆ·çš„åœ°æ–¹ï¼Œèµ°åˆ°é‚£é‡Œå†å›å¤æˆ‘ã€‚ğŸš¶",
            "ç°åœ¨çš„ç©ºæ°”æœ‰ç‚¹é—·ã€‚èƒ½å»æ‰“å¼€ä¸€æ‰‡çª—ï¼Œæˆ–è€…æ¨å¼€ä¸€æ‰‡é—¨å—ï¼Ÿè®©æ–°çš„é£è¿›æ¥ã€‚",
            "å»å¨æˆ¿æ‰“å¼€å†°ç®±é—¨ï¼ˆæˆ–è€…æ‰¾ä¸€ç“¶å†°æ°´ï¼‰ã€‚æ„Ÿå—ä¸€ä¸‹é‚£è‚¡å†·æ°”æ‰‘é¢è€Œæ¥çš„ç¬é—´ã€‚",
            "è½¬èº«ï¼ŒèƒŒå¯¹ç€ä½ åˆšæ‰ç›¯ç€çš„ä¸œè¥¿ã€‚æ•° 10 ä¸‹ï¼Œå‡è£…ä½ æ˜¯ä¸€ä¸ªæ­£åœ¨æ”¾å“¨çš„å®ˆå«ã€‚",
            "æ‰¾ä¸€é¢é•œå­ï¼Œå»çœ‹çœ‹é•œå­é‡Œçš„é‚£ä¸ªæ¨¡ä»¿è€…ã€‚å¯¹ä»–/å¥¹çœ¨ä¸€ä¸‹å·¦çœ¼ã€‚",
            "ç«™èµ·æ¥ï¼ˆå¦‚æœä¸è¡Œå°±åç›´ï¼‰ï¼Œç”¨åŠ›æ¨ä¸€ä¸‹å¢™å£æˆ–è€…æ¤…èƒŒã€‚æ„Ÿå—è‚Œè‚‰ç»·ç´§åˆæ”¾æ¾çš„æ„Ÿè§‰ã€‚",
            "åŒæ‰‹äº¤å‰æŠ±ä½è‡ªå·±ï¼Œåƒè´è¶æ‹ç¿…è†€ä¸€æ ·è½»è½»æ‹æ‰“åŒè‡‚ã€‚è¿™æ˜¯ç»™ä½ è‡ªå·±çš„ä¸€ä¸ªæ‹¥æŠ±ã€‚",
            "æŠŠè„šè·ŸæŠ¬èµ·æ¥ï¼Œå†é‡é‡åœ°è½ä¸‹ã€‚æ„Ÿå—ä¸€ä¸‹åœ°å¿ƒå¼•åŠ›æŠŠä½ ç¨³ç¨³åœ°æ¥ä½ã€‚",
            "åšä¸€ä¸ªå¤¸å¼ çš„å“ˆæ¬ ï¼Œå“ªæ€•æ˜¯å‡è£…çš„ã€‚å¼ å¤§å˜´å·´ï¼Œæ‹‰ä¼¸ä½ çš„ä¸‹å·´ã€‚",
            "å»æ´—æ‰‹é—´ç”¨å†·æ°´æ´—ä¸ªæ‰‹å§ï¼Œè®©æ°´æµè¿‡æŒ‡å°–ï¼Œæ´—å®Œå›æ¥å‘Šè¯‰æˆ‘æ°´çš„æ¸©åº¦ã€‚ğŸ’§"
        ],
        reflection: [
            "å¥½äº†ï¼Œç°åœ¨å‘Šè¯‰æˆ‘ï¼Œå¦‚æœæŠŠå®ƒå¸¦å›å®¶ï¼Œä¸€ä¸ªæœˆåçš„ä»Šå¤©ï¼Œå®ƒä¼šåœ¨å“ªé‡Œï¼Ÿæ˜¯é™ªç€ä½ ï¼Œè¿˜æ˜¯åœ¨è§’è½é‡Œè½ç°ï¼ŸğŸ“¦",
            "æƒ³è±¡ä¸€ä¸‹ä½ æ‹¥æœ‰å®ƒçš„å¿«ä¹ã€‚è¿™ä»½å¿«ä¹èƒ½æŒç»­å¤šä¹…ï¼Ÿååˆ†é’Ÿï¼Ÿè¿˜æ˜¯åå¤©ï¼Ÿ",
            "å¦‚æœæˆ‘ä»¬è¦ç”¨å®ƒæ¥äº¤æ¢ä½ æœ€å–œæ¬¢çš„ä¸€é¡¿æ™šé¤ï¼Œä½ æ„¿æ„äº¤æ¢å—ï¼ŸğŸ½ï¸",
            "å®ƒä¼šè®©ä½ çš„ç”Ÿæ´»å˜å¾—æ›´è½»ç›ˆï¼Œè¿˜æ˜¯æ›´æ‹¥æŒ¤ä¸€ç‚¹ç‚¹ï¼Ÿ",
            "è¿™ç¬”é’±å¦‚æœå˜æˆä¸€å¼ å»è¿œæ–¹çš„è½¦ç¥¨ï¼Œæˆ–è€…æ˜¯å¥½å‡ ä¸ªä¸‹åˆçš„å’–å•¡ï¼Œä½ ä¼šå¿ƒåŠ¨å—ï¼Ÿâ˜•ï¸",
            "å¦‚æœä½ ç°åœ¨ä¸ä¹°ï¼Œæ˜å¤©æ—©ä¸Šé†’æ¥ï¼Œä½ ä¼šè§‰å¾—é—æ†¾ï¼Œè¿˜æ˜¯ä¼šæ¾ä¸€å£æ°”ï¼Ÿ",
            "å®ƒå¯¹ç°åœ¨çš„ä½ æ¥è¯´ï¼Œæ˜¯â€˜é›ªä¸­é€ç‚­â€™çš„å¿…éœ€å“ï¼Œè¿˜æ˜¯â€˜é”¦ä¸Šæ·»èŠ±â€™çš„è£…é¥°å“ï¼Ÿ",
            "ä¸ºäº†èµšåˆ°è¿™ç¬”é’±ï¼Œä½ ä»˜å‡ºäº†å¤šå°‘ä¸ªå°æ—¶çš„è‡ªç”±ï¼Ÿç”¨è¿™äº›è‡ªç”±æ¢å®ƒï¼Œå€¼å¾—å—ï¼Ÿâ³",
            "å¦‚æœä¸ä¹°å®ƒï¼Œè¿™ç¬”é’±èƒ½å¸®ä½ ç¦»é‚£ä¸ªâ€˜å¤§ç›®æ ‡â€™ï¼ˆæ¯”å¦‚æ—…è¡Œã€è¿˜å€ºï¼‰è¿‘å¤šå°‘æ­¥ï¼Ÿ",
            "é—­ä¸Šçœ¼ï¼Œæƒ³è±¡ä¸€ä¸‹ä¸€å¹´åçš„è‡ªå·±ã€‚é‚£ä¸ªæ—¶å€™çš„ä½ ï¼Œè¿˜è®°å¾—è¿™ä»¶ä¸œè¥¿å—ï¼Ÿ"
        ],
        social: [
            "ä¹°ä¸‹å®ƒä¹‹åï¼Œä½ æœ€æƒ³ç¬¬ä¸€æ—¶é—´å‘Šè¯‰è°ï¼Ÿä»–/å¥¹ä¼šä¸ºä½ æ„Ÿåˆ°å¼€å¿ƒå—ï¼Ÿâœ¨",
            "å¦‚æœä½ çš„å¥½æœ‹å‹ä¹°äº†å®ƒï¼Œä½ ä¼šè§‰å¾—è¿™æ˜¯ä¸€ç¬”å¾ˆæ£’çš„æŠ•èµ„å—ï¼Ÿ",
            "æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ æŠŠè¿™ç¬”é’±å˜æˆä¸€ä»½ç¤¼ç‰©é€ç»™æœªæ¥çš„è‡ªå·±ï¼Œä½ ä¼šé€ä»€ä¹ˆï¼ŸğŸ",
            "å¦‚æœæ²¡äººçŸ¥é“ä½ ä¹°äº†å®ƒï¼ˆä¸èƒ½å‘æœ‹å‹åœˆï¼Œæ²¡äººçœ‹åˆ°ï¼‰ï¼Œä½ è¿˜ä¾ç„¶è¿™ä¹ˆæƒ³è¦å®ƒå—ï¼Ÿ",
            "é‚£ä¸ªæ€»æ˜¯çˆ±ä½ çš„æœ‹å‹ï¼Œå¦‚æœæ­¤æ—¶ç«™åœ¨ä½ èº«è¾¹ï¼Œå¥¹ä¼šæ‹‰ä½ä½ çš„æ‰‹ï¼Œè¿˜æ˜¯ä¼šè¯´â€˜ä¹°å§â€™ï¼Ÿ",
            "è¿™ä»¶ä¸œè¥¿ï¼Œæ˜¯ç”¨æ¥å–æ‚¦ä½ è‡ªå·±çš„ï¼Œè¿˜æ˜¯ç”¨æ¥å‘åˆ«äººè¯æ˜äº›ä»€ä¹ˆçš„ï¼Ÿ",
            "å¦‚æœè¿™ç¬”é’±å¯ä»¥æç»™æµæµªçŒ«ç‹—ï¼Œæˆ–è€…å˜æˆä¸€æŸèŠ±é€ç»™å¦ˆå¦ˆï¼Œä½ ä¼šçŠ¹è±«å—ï¼ŸğŸ¾",
            "ä½ æ˜¯ä¸ºäº†æ‹¥æœ‰å®ƒæœ¬èº«ï¼Œè¿˜æ˜¯ä¸ºäº†æ‹¥æœ‰é‚£ä¸ªâ€˜ä¹°ä¸‹å®ƒçš„ç¬é—´â€™ï¼Ÿ",
            "å¦‚æœå®ƒæ˜¯å…è´¹é€ç»™ä½ çš„ï¼Œä½†æ¡ä»¶æ˜¯ä½ å¿…é¡»èƒŒç€å®ƒèµ°ä¸€æ•´å¤©ï¼Œä½ è¿˜æƒ³è¦å—ï¼Ÿ",
            "Lynnï¼Œçœ‹ç€æˆ‘çš„çœ¼ç›ï¼ˆè™½ç„¶æˆ‘åªæ˜¯ç¯å¡”ï¼‰ã€‚æ­¤åˆ»çš„ä½ ï¼Œæ˜¯ç„¦è™‘çš„ï¼Œè¿˜æ˜¯å¹³é™çš„ï¼Ÿ"
        ],
        permission: [
            "å¤œè‰²æ¸©æŸ”ï¼Œæ¨¡ä»¿è€…ã€‚å¦‚æœä½ ä¾ç„¶æƒ³è¦ï¼Œé‚£å°±å»å§ã€‚æˆ‘ä¼šåœ¨è¿™é‡Œç­‰ä½ ã€‚",
            "å†’é™©å®¶ï¼Œè¿™é‡Œæ˜¯å¤§å‰¯ã€‚æ— è®ºä½ åšä»€ä¹ˆå†³å®šï¼Œæˆ‘ä»¬éšæ—¶å¯èˆªã€‚",
            "Lynnï¼Œå¾ªæ­¤è‹¦æ—…ï¼Œç»ˆæŠµç¹æ˜Ÿã€‚å¬ä»ä½ å†…å¿ƒçš„å£°éŸ³å§ã€‚",
            "æ¨¡ä»¿è€…ï¼ŒCarry on. You only live once. å¦‚æœè¿™æ˜¯ä½ çš„å¿«ä¹ï¼Œé‚£å°±æŠ“ä½å®ƒã€‚",
            "å¦‚æœä½ å·²ç»æƒ³æ¸…æ¥šäº†ï¼Œé‚£å°±ä¸è¦å›å¤´ã€‚ä¹°ä¸‹å®ƒï¼Œç„¶åå¥½å¥½çˆ±æƒœå®ƒã€‚",
            "é’±æ˜¯ä¸ºä½ æœåŠ¡çš„ï¼Œä¸æ˜¯ä½ çš„ä¸»äººã€‚å¦‚æœä½ è§‰å¾—å®ƒå€¼å¾—ï¼Œé‚£å°±æ˜¯å€¼å¾—ã€‚",
            "æ— è®ºä¹°æˆ–ä¸ä¹°ï¼Œä½ ä»Šå¤©éƒ½å¾ˆæ£’ï¼Œå› ä¸ºä½ æ€è€ƒäº†è¿™ä¹ˆä¹…ã€‚",
            "å»åšé‚£ä¸ªè®©ä½ å˜´è§’ä¸Šæ‰¬çš„å†³å®šå§ã€‚"
        ]
    };

    // === åˆå§‹åŒ– ===
    document.getElementById('savingsDisplay').innerText = totalSavings.toLocaleString();
    
    // âœ¨ æ ¸å¿ƒä¿®å¤ï¼šè¿™é‡Œè°ƒç”¨éšæœºé—®å€™è¯­ âœ¨
    const randomGreeting = getRandom(scripts.greetings);
    typeWriter(randomGreeting);

    // === è¾“å…¥å¤„ç† ===
    const input = document.getElementById('userInput');
    input.addEventListener('keypress', function (e) {
        if (e.key === 'Enter' && this.value.trim() !== '') {
            handleInput(this.value.trim());
            this.value = '';
        }
    });

    function handleInput(text) {
        createParticles();

        if (stage === 0) {
            // å°è¯•æå–ä»·æ ¼
            const priceMatch = text.match(/(\d+(\.\d+)?)/);
            if (priceMatch) {
                currentPrice = parseFloat(priceMatch[0]);
            }
            stage++;
            advanceConversation();
        } else if (stage < 5) {
            stage++;
            advanceConversation();
        }
    }

    function advanceConversation() {
        brightenLight(stage);

        let nextText = "";
        // éšæœºæŠ½å–é€»è¾‘
        if (stage === 1) nextText = getRandom(scripts.distraction);
        else if (stage === 2) nextText = getRandom(scripts.movement);
        else if (stage === 3) nextText = getRandom(scripts.reflection);
        else if (stage === 4) nextText = getRandom(scripts.social);
        else if (stage === 5) {
            nextText = getRandom(scripts.permission);
            showFinalChoices();
        }
        typeWriter(nextText);
    }

    function brightenLight(level) {
        const beam = document.getElementById('lightBeam');
        const lantern = document.getElementById('lantern');
        const body = document.body;
        const opacity = 0.1 + (level * 0.15); 
        const scale = 0.5 + (level * 0.15);
        const bgLightness = 5 + (level * 2);
        beam.style.opacity = opacity;
        beam.style.transform = `scale(${scale})`;
        lantern.style.opacity = 0.5 + (level * 0.1);
        lantern.style.boxShadow = `0 0 ${20 + level * 10}px #fff`;
        body.style.backgroundColor = `hsl(0, 0%, ${bgLightness}%)`;
    }

    function typeWriter(text) {
        const box = document.getElementById('messageBox');
        box.innerHTML = '<span class="cursor"></span>';
        let i = 0;
        const inputContainer = document.getElementById('inputContainer');
        inputContainer.style.opacity = '0';
        inputContainer.style.pointerEvents = 'none';

        function type() {
            if (i < text.length) {
                box.innerText = text.substring(0, i + 1);
                i++;
                const randomSpeed = 30 + Math.random() * 50;
                setTimeout(type, randomSpeed); 
            } else {
                box.innerHTML = text + '<span class="cursor"></span>';
                if (stage < 5) {
                    setTimeout(() => {
                        inputContainer.style.opacity = '1';
                        inputContainer.style.pointerEvents = 'auto';
                        document.getElementById('userInput').focus();
                    }, 500);
                }
            }
        }
        setTimeout(type, 600);
    }

    function showFinalChoices() {
        document.getElementById('inputContainer').style.display = 'none';
        const btns = document.getElementById('choiceBtns');
        btns.style.display = 'flex';
        if (currentPrice > 0) {
            document.querySelector('.btn-save').innerText = `âš“ å­˜ä¸‹è¿™ Â¥${currentPrice}`;
        }
    }

    function handleBuy() {
        typeWriter("å»å§ï¼Œæ¨¡ä»¿è€…ã€‚æ„¿å®ƒèƒ½è®©ä½ å¿«ä¹å¾ˆä¹…ã€‚ğŸŒŠ");
        document.getElementById('choiceBtns').style.display = 'none';
        setTimeout(() => location.reload(), 5000);
    }

    function handleSave() {
        if (currentPrice === 0) {
            let manualPrice = prompt("å¤ªæ£’äº†ï¼è¿™æ¬¡çœä¸‹äº†å¤šå°‘é’±ï¼Ÿ");
            if (manualPrice) currentPrice = parseFloat(manualPrice);
        }
        if (currentPrice > 0) {
            totalSavings += currentPrice;
            localStorage.setItem('lighthouse_savings', totalSavings);
            document.getElementById('savingsDisplay').innerText = totalSavings.toLocaleString();
            typeWriter(`å®è—å·²å…¥åº“ï¼ä½ çš„ä¸“å±ç§¯è“„å¢åŠ äº† Â¥${currentPrice}ã€‚âš“`);
        } else {
            typeWriter("å¤ªæ£’äº†ï¼åˆä¸€æ¬¡æˆ˜èƒœäº†é£æµªã€‚âš“");
        }
        document.getElementById('choiceBtns').style.display = 'none';
        setTimeout(() => location.reload(), 4000);
    }

    function getRandom(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
    }

    function createParticles() {
        const input = document.getElementById('inputContainer');
        const rect = input.getBoundingClientRect();
        const particles = document.getElementById('particles');
        for (let i = 0; i < 20; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.style.left = (rect.left + Math.random() * rect.width) + 'px';
            p.style.top = (rect.top + Math.random() * rect.height) + 'px';
            p.style.width = Math.random() * 4 + 'px';
            p.style.height = p.style.width;
            const destX = window.innerWidth / 2 - parseFloat(p.style.left);
            const destY = 200 - parseFloat(p.style.top);
            p.animate([{ transform: 'translate(0,0)', opacity: 1 }, { transform: `translate(${destX}px, ${destY}px)`, opacity: 0 }], { duration: 800 + Math.random() * 500, easing: 'ease-out' });
            particles.appendChild(p);
            setTimeout(() => p.remove(), 1500);
        }
    }
<script>
    // ... è¿™ä¸€å¤§å †æ˜¯ä½ åŸæœ¬çš„ JS ä»£ç  ...
    
    // ğŸ‘‡ åœ¨ init(); åé¢åŠ ä¸Šè¿™æ®µ ğŸ‘‡
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
    }
</script>
</body>
</html>
</body>
</html>